#!/usr/bin/env bash

export GOPATH=$PWD

if [ "$(uname -s)" = "Darwin" ]; then
    alias ls="ls --color=auto"
    alias ll="ls -l"
else
    alias open="xdg-open"
fi

if [ ! -d "$GOPATH/bin" ]; then
    mkdir "$GOPATH/bin"
fi

gofmts() {
    if gofmt -w -s -e "$1"; then
        awk '{ gsub(/\t/, "    "); print }' < "$1" > tmp
        cat tmp > "$1"
        rm tmp
    fi
}

golint_() {
    golint "$1" \
        | sed -n -e '/exported .* should have comment.* or be unexported/!p'
}

goall() {
    cd "$GOPATH" || exit
    find . -type f -name '*.go' \
        -exec bash -c 'echo "$0"; golint_ "$0"; gofmts "$0"' {} \;
}

rung() {
    handle=$(echo "$1" | sed 's/^[a-z\/]*\/\(.*\)\.[a-z]*$/\1/')
    go build -o "$GOPATH/bin/$handle" "$1"
    "$GOPATH/bin/$handle"
}

export -f gofmts
export -f golint_
export -f goall
